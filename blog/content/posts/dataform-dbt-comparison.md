---
title: "dbt vs Dataform"
date: 2021-01-26T10:40:39+09:00
draft: false
description: ""
tags: []
---

最近、業務でDWH/Datamartの整備や品質担保を効率的に行いたくなる事情があり、調査したところdbtとdataformがツールとして有力そうだったので、比較してみました。

# TL;DR

* dbtは機能が充実しており、カスタマイズするポイントも多く、様々な用途に向く反面、理解し使いこなすための学習コストがかかります。
* dataformはWebビューによる開発体験が非常に良いです。機能もほとんどはわかりやすく、迷うことも少ないです。一方、dbtに比較して融通はききづらいのと、独特な環境分離の方法を受け入れる必要があります。
* どちらも十分な機能は備えているので、どちらが良いかは導入する組織の環境やカルチャー次第でしょう。
* dbtは強固なエンジニアリング組織を持つならばdbt、GCPを利用して分析基盤を作ったりもするが、やりたいことはシンプルでツールの運用にもコストをかけられない場合はdataformが良いでしょう。

# 筆者のおかれた環境

* toB / toCの自社ウェブサービスを運営する企業 (Ubie, inc)
* データ活用が根幹となるサービスであり、プリミティブなデータ基盤は存在
* データの活用方法は、MLでの利用から、ビジネスサイドがBIでクライアントやサービスの状況を知るなど多岐に渡る
* GCPを全社的に利用
* 成熟したエンジニアリング組織を持つ。データ基盤を主に担当する専属のデータエンジニアも数名いる。筆者はデータエンジニア。

# dbt, dataformについてざっくり

どちらも、ETL / ELTにおけるT (Transformation) を担当するツールです。

つまりは、様々なデータソースからデータレイクにロードされたデータを、ビジネスやプロダクトが使いやすい形に変換する部分を担います。

### [dbt](https://docs.getdbt.com/docs/introduction)

[fishtown analytics](https://www.fishtownanalytics.com/) という組織により、2016年から開発されています。dbtとは、 `data build tool` の略です。

CLIとして利用するOSS版と、dbt Cloudという統合開発環境＋実行環境が付属した商用版があります。CLIの場合、スケジューラーや実行環境がないため、cronやAirflowなどとともに利用することになるでしょう。

### [dataform](https://docs.dataform.co/)

2020年12月に、[Googleによる買収が発表され](https://cloud.google.com/blog/products/data-analytics/welcoming-dataform-to-bigquery)、界隈では非常に話題になりました。いつからサービスを開始しているのかわかりませんが、私自身は存在すらしりませんでした。

基本的には、統合開発環境と実行環境をセットで提供しています。CLIやREST APIもありますが、基本的にはGUIを利用します。

※ この記事ではCLI版のdbtのみ扱います。

# 比較

いくつかの候補軸で比較をしていこうと思います

## 対応するプラットフォーム

* dbt
  * Postgres, RedShift, BigQuery, Snowflake, Apache Spark, Databricks, Presto, (その他、サードパーティ製のコネクタあり)
* Dataform
  * BigQuery, Snowflake, Redshift, Azure SQL DW, Postgres

どちらも必要十分なカバーはできている印象です。dbtはOSSであるため、独自のコネクタを開発することが可能です。

## 主要な機能

* dbt, Dataform共通
  * データモデルの定義
  * データソースの定義
  * スナップショットの作成
  * データ品質テストの定義
  * モデル間依存関係の自動的な解決
  * プラットフォームにデータ定義（カラムディスクリプションなど）を反映
* dbtのみ
  * データソースの鮮度チェック
  * マクロによる拡張コード
  * ドキュメントの自動生成
  * 分析用SQLの管理
  * 実行前後のHook
* Dataformのみ
  * 付属のスケジューラと実行環境
  * ウェブ上の統合開発環境と管理画面
  * Javascriptによる拡張コード

dbtのほうが幅広い機能群を持っています。特に、dbtで管理しないデータソースに対しても品質チェックできるのが便利です。ただ、Dataformでも必要十分な機能は備えている印象です。

### DataformのWeb画面

DataformはなんといってもWeb画面が非常に使いやすいです。以下のような良い点があります。

* コードの補完
* 開発しているSQLの実行
* 品質テストに失敗した場合、どの行で失敗したかをデータベースに格納してくれるので、調査も非常にしやすい
* ソースのバージョンコントロール
* スケジュールの設定
* 実行履歴の閲覧やリラン

![Dataform web view](/images/dbt-dataform-comparison/dataform_web_view.png)

## カスタマイズ性・外部ツールとの接続性



## 実際の運用

# 考察

* 特徴
* ユースケース
* 個人的な好み
* 足りていないこと
* 我々の選択
  * これは別ブログでもいいかも